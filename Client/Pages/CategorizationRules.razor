@page "/categorization-rules"
@using global::App.Read.Ports

<div class="row justify-content-between">
    <div class="col-auto">
        @if (isCreating)
        {
            <EditForm Model="CategorizationRule" OnSubmit="Create" FormName="CreateCategory" class="row row-cols-lg-auto g-3 align-items-center">
                <div class="col-12">
                    <InputSelect @bind-Value="CategorizationRule!.CategoryId" class="form-select">
                        @if (categories != null && categories.Any())
                        {
                            <option value="" disabled selected>Category</option>

                            @foreach (CategorySummaryPresentation category in categories.OrderBy(c => c.Label))
                            {
                                <option value="@category.Id">@category.Label</option>

                                @foreach (ChildCategorySummaryPresentation child in category.Children.OrderBy(c => c.Label))
                                {
                                    <option value="@child.Id">&nbsp;&nbsp;@child.Label</option>
                                }
                            }
                        }
                    </InputSelect>
                </div>
                <div class="col-12">
                    <InputText @bind-Value="CategorizationRule!.Keywords" class="form-control" placeholder="Keywords"></InputText>
                </div>
                <div class="col-12">
                    <InputNumber @bind-Value="CategorizationRule!.Amount" class="form-control" placeholder="Amount"></InputNumber>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </EditForm>
        }
        else
        {
            <button class="btn btn-primary" @onclick="EnterCreateMode" disabled="@(categories is { Length: 0 })">
                <small class="bi bi-plus-lg"></small>
                Create
            </button>
        }
    </div>
    <div class="col-auto text-end">
        <div class="btn-group">
            <label class="btn btn-primary">
                <small class="bi bi-upload"></small>
                Import
                <InputFile OnChange="ImportCategorizationRulesFile" accept=".csv" class="btn btn-primary d-none"></InputFile>
            </label>
            <button class="btn btn-primary" @onclick="ExportCategorizationRules" disabled="@(categorizationRules is { Length: 0 })">
                <small class="bi bi-download"></small>
                Export
            </button>
        </div>
        @if (uploadResult != null)
        {
            <div>@uploadResult</div>
        }
    </div>
</div>

@if (categorizationRules is { Length: > 0 })
{
    <ul class="list-group list-group-flush">
        @foreach (CategorizationRuleSummaryPresentation categorizationRule in categorizationRules.OrderBy(r => r.CategoryLabel).ThenBy(r => r.Keywords))
        {
            <li class="list-group-item">
                @categorizationRule.CategoryLabel (@categorizationRule.Keywords / @categorizationRule.Amount)
                <button class="btn btn-link" @onclick="() => Delete(categorizationRule)">Delete</button>
            </li>
        }
    </ul>
}